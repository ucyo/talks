<!DOCTYPE html>
<html>
  <head>
    <title>Python packaging and dependency management</title>
    <meta charset="utf-8">
    <style>
      @import url(https://fonts.googleapis.com/css?family=Merriweather:400);
      @import url(https://fonts.googleapis.com/css?family=Montserrat:400,700,400italic);
      @import url(https://fonts.googleapis.com/css?family=Roboto:400,700,400italic);
    </style>
    <link rel="stylesheet" type="text/css" href="style.css" media="screen"/>
  </head>
  <body>
    <textarea id="source">


class: center, middle


# Poetry
## Python packaging and dependency management
Python Meeting IMK 

[2020/08/26]


---

# Why setting up environments?

- **Reproducibility** <br> The Python application should run everywhere as intended.
- **Dependency of projects** <br> Projects might use modules working only with specific versions 
- **Support more Python versions** <br> Projects running e.g. with `Python3.5`, `3.6`, ..., `2.7` **:'(**
- **Isolation** <br> Starting with a blank sheet

How is the current field of Python dependency management? 
---

# Python Dependency Management

.center[<img src="https://imgs.xkcd.com/comics/python_environment.png" width=470>]

---

# Python **Interpreter** Vs. Python **Module** 

.left-column[
  ## Python versions
  
  Select which Python interpreter to use e.g. `python3.8`, `python2.7`,
  `python3.8.2`

  ```bash
  pyenv
  ```

  - Local installation of every possible Python version e.g pypy, (ana/mini)conda, jython
  - Simple switch per project/folder possible
]

.right-column[
  ## Module versions
  Define which library modules to use e.g. `numpy19.0.2`, `pandas1.2.4`, `xarray2.21.2` 

  ```bash
  poetry
  ```

  - Dependency management
  - Packaging to wheels/tars
  - Publishing to PyPI
  - Single configuration file
  ]

---

class: center, middle

# Installation, Update and Uninstall

  
---

# Pyenv (Install/Uninstall)

*Download installer*
```bash
wget https://github.com/pyenv/pyenv-installer/raw/master/bin/pyenv-installer
```

*Install*
```bash
bash pyenv-installer
```

*Update*
```bash
pyenv update
```

*Uninstall*
```bash
rm -rf $(pyenv root)
```

---

# Poetry (Install/Uninstall)

*Download installer*
```bash
wget https://raw.githubusercontent.com/python-poetry/poetry/master/get-poetry.py
```

*Install*
```bash
python get-poetry.py
```

*Update itself*
```bash
poetry self update
```

*Uninstall*
```bash
python get-poetry.py --uninstall
```
--
.red[
*Sane defaults?*
```bash
poetry config virtualenvs.in-project true
```
]

---

class: center, middle

# *Typical* usage of pyenv and poetry

---

# Pyenv (information)

List available Python interpreters. Asterix marks activated one.
```bash
> pyenv versions       
 *system (set by /home/ucyo/.pyenv/version)
  3.8.5
```
List all possible Python versions.

```bash
> pyenv install --list                                                                                                     22
Available versions:
  2.1.3
  2.2.3
  2.3.7
  2.4.0
  2.4.1
  2.4.2
  2.4.3
  2.4.4
  2.4.5
  2.4.6
  2.5.0
  2.5.1
  2.5.2
  2.5.3
  2.5.4
  2.5.5
  2.5.6
  2.6.6
  2.6.7
  2.6.8
  2.6.9
  2.7.0
  2.7-dev
  2.7.1
  2.7.2
  2.7.3
  2.7.4
  2.7.5
  2.7.6
  2.7.7
  2.7.8
  2.7.9
  2.7.10
  2.7.11
  2.7.12
  2.7.13
  2.7.14
  2.7.15
  2.7.16
  2.7.17
  2.7.18
  3.0.1
  3.1.0
  3.1.1
  3.1.2
  3.1.3
  3.1.4
  3.1.5
  3.2.0
  3.2.1
  3.2.2
  3.2.3
  3.2.4
  3.2.5
  3.2.6
  3.3.0
  3.3.1
  3.3.2
  3.3.3
  3.3.4
  3.3.5
  3.3.6
  3.3.7
  3.4.0
  3.4-dev
  3.4.1
  3.4.2
  3.4.3
  3.4.4
  3.4.5
  3.4.6
  3.4.7
  3.4.8
  3.4.9
  3.4.10
  3.5.0
  3.5-dev
  3.5.1
  3.5.2
  3.5.3
  3.5.4
  3.5.5
  3.5.6
  3.5.7
  3.5.8
  3.5.9
  3.6.0
  3.6-dev
  3.6.1
  3.6.2
  3.6.3
  3.6.4
  3.6.5
  3.6.6
  3.6.7
  3.6.8
  3.6.9
  3.6.10
  3.6.11
  3.6.12
  3.7.0
  3.7-dev
  3.7.1
  3.7.2
  3.7.3
  3.7.4
  3.7.5
  3.7.6
  3.7.7
  3.7.8
  3.7.9
  3.8.0
  3.8-dev
  3.8.1
  3.8.2
  3.8.3
  3.8.4
  3.8.5
  3.9.0rc1
  3.9-dev
  3.10-dev
  activepython-2.7.14
  activepython-3.5.4
  activepython-3.6.0
  anaconda-1.4.0
  anaconda-1.5.0
  anaconda-1.5.1
  anaconda-1.6.0
  anaconda-1.6.1
  anaconda-1.7.0
  anaconda-1.8.0
  anaconda-1.9.0
  anaconda-1.9.1
  anaconda-1.9.2
  anaconda-2.0.0
  anaconda-2.0.1
  anaconda-2.1.0
  anaconda-2.2.0
  anaconda-2.3.0
  anaconda-2.4.0
  anaconda-4.0.0
  anaconda2-2.4.0
  anaconda2-2.4.1
  anaconda2-2.5.0
  anaconda2-4.0.0
  anaconda2-4.1.0
  anaconda2-4.1.1
  anaconda2-4.2.0
  anaconda2-4.3.0
  anaconda2-4.3.1
  anaconda2-4.4.0
  anaconda2-5.0.0
  anaconda2-5.0.1
  anaconda2-5.1.0
  anaconda2-5.2.0
  anaconda2-5.3.0
  anaconda2-5.3.1
  anaconda2-2018.12
  anaconda2-2019.03
  anaconda2-2019.07
  anaconda3-2.0.0
  anaconda3-2.0.1
  anaconda3-2.1.0
  anaconda3-2.2.0
  anaconda3-2.3.0
  anaconda3-2.4.0
  anaconda3-2.4.1
  anaconda3-2.5.0
  anaconda3-4.0.0
  anaconda3-4.1.0
  anaconda3-4.1.1
  anaconda3-4.2.0
  anaconda3-4.3.0
  anaconda3-4.3.1
  anaconda3-4.4.0
  anaconda3-5.0.0
  anaconda3-5.0.1
  anaconda3-5.1.0
  anaconda3-5.2.0
  anaconda3-5.3.0
  anaconda3-5.3.1
  anaconda3-2018.12
  anaconda3-2019.03
  anaconda3-2019.07
  anaconda3-2019.10
  anaconda3-2020.02
  ironpython-dev
  ironpython-2.7.4
  ironpython-2.7.5
  ironpython-2.7.6.3
  ironpython-2.7.7
  jython-dev
  jython-2.5.0
  jython-2.5-dev
  jython-2.5.1
  jython-2.5.2
  jython-2.5.3
  jython-2.5.4-rc1
  jython-2.7.0
  jython-2.7.1
  micropython-dev
  micropython-1.9.3
  micropython-1.9.4
  micropython-1.10
  micropython-1.11
  micropython-1.12
  miniconda-latest
  miniconda-2.2.2
  miniconda-3.0.0
  miniconda-3.0.4
  miniconda-3.0.5
  miniconda-3.3.0
  miniconda-3.4.2
  miniconda-3.7.0
  miniconda-3.8.3
  miniconda-3.9.1
  miniconda-3.10.1
  miniconda-3.16.0
  miniconda-3.18.3
  miniconda2-latest
  miniconda2-3.18.3
  miniconda2-3.19.0
  miniconda2-4.0.5
  miniconda2-4.1.11
  miniconda2-4.3.14
  miniconda2-4.3.21
  miniconda2-4.3.27
  miniconda2-4.3.30
  miniconda2-4.3.31
  miniconda2-4.4.10
  miniconda2-4.5.1
  miniconda2-4.5.4
  miniconda2-4.5.11
  miniconda2-4.5.12
  miniconda2-4.6.14
  miniconda2-4.7.10
  miniconda2-4.7.12
  miniconda3-latest
  miniconda3-2.2.2
  miniconda3-3.0.0
  miniconda3-3.0.4
  miniconda3-3.0.5
  miniconda3-3.3.0
  miniconda3-3.4.2
  miniconda3-3.7.0
  miniconda3-3.8.3
  miniconda3-3.9.1
  miniconda3-3.10.1
  miniconda3-3.16.0
  miniconda3-3.18.3
  miniconda3-3.19.0
  miniconda3-4.0.5
  miniconda3-4.1.11
  miniconda3-4.2.12
  miniconda3-4.3.11
  miniconda3-4.3.14
  miniconda3-4.3.21
  miniconda3-4.3.27
  miniconda3-4.3.30
  miniconda3-4.3.31
  miniconda3-4.4.10
  miniconda3-4.5.1
  miniconda3-4.5.4
  miniconda3-4.5.11
  miniconda3-4.5.12
  miniconda3-4.6.14
  miniconda3-4.7.10
  miniconda3-4.7.12
  pypy-c-jit-latest
  pypy-c-nojit-latest
  pypy-dev
  pypy-stm-2.3
  pypy-stm-2.5.1
  pypy-1.5-src
  pypy-1.5
  pypy-1.6
  pypy-1.7
  pypy-1.8
  pypy-1.9
  pypy-2.0-src
  pypy-2.0
  pypy-2.0.1-src
  pypy-2.0.1
  pypy-2.0.2-src
  pypy-2.0.2
  pypy-2.1-src
  pypy-2.1
  pypy-2.2-src
  pypy-2.2
  pypy-2.2.1-src
  pypy-2.2.1
  pypy-2.3-src
  pypy-2.3
  pypy-2.3.1-src
  pypy-2.3.1
  pypy-2.4.0-src
  pypy-2.4.0
  pypy-2.5.0-src
  pypy-2.5.0
  pypy-2.5.1-src
  pypy-2.5.1
  pypy-2.6.0-src
  pypy-2.6.0
  pypy-2.6.1-src
  pypy-2.6.1
  pypy-4.0.0-src
  pypy-4.0.0
  pypy-4.0.1-src
  pypy-4.0.1
  pypy-5.0.0-src
  pypy-5.0.0
  pypy-5.0.1-src
  pypy-5.0.1
  pypy-5.1-src
  pypy-5.1
  pypy-5.1.1-src
  pypy-5.1.1
  pypy-5.3-src
  pypy-5.3
  pypy-5.3.1-src
  pypy-5.3.1
  pypy-5.4-src
  pypy-5.4
  pypy-5.4.1-src
  pypy-5.4.1
  pypy-5.6.0-src
  pypy-5.6.0
  pypy-5.7.0-src
  pypy-5.7.0
  pypy-5.7.1-src
  pypy-5.7.1
  pypy2-5.3-src
  pypy2-5.3
  pypy2-5.3.1-src
  pypy2-5.3.1
  pypy2-5.4-src
  pypy2-5.4
  pypy2-5.4.1-src
  pypy2-5.4.1
  pypy2-5.6.0-src
  pypy2-5.6.0
  pypy2-5.7.0-src
  pypy2-5.7.0
  pypy2-5.7.1-src
  pypy2-5.7.1
  pypy2.7-5.8.0-src
  pypy2.7-5.8.0
  pypy2.7-5.9.0-src
  pypy2.7-5.9.0
  pypy2.7-5.10.0-src
  pypy2.7-5.10.0
  pypy2.7-6.0.0-src
  pypy2.7-6.0.0
  pypy2.7-7.0.0-src
  pypy2.7-7.0.0
  pypy2.7-7.1.0-src
  pypy2.7-7.1.0
  pypy2.7-7.1.1-src
  pypy2.7-7.1.1
  pypy2.7-7.2.0-src
  pypy2.7-7.2.0
  pypy2.7-7.3.0-src
  pypy2.7-7.3.0
  pypy2.7-7.3.1-src
  pypy2.7-7.3.1
  pypy3-dev
  pypy3-2.3.1-src
  pypy3-2.3.1
  pypy3-2.4.0-src
  pypy3-2.4.0
  pypy3.3-5.2-alpha1-src
  pypy3.3-5.2-alpha1
  pypy3.3-5.5-alpha-src
  pypy3.3-5.5-alpha
  pypy3.5-c-jit-latest
  pypy3.5-5.7-beta-src
  pypy3.5-5.7-beta
  pypy3.5-5.7.1-beta-src
  pypy3.5-5.7.1-beta
  pypy3.5-5.8.0-src
  pypy3.5-5.8.0
  pypy3.5-5.9.0-src
  pypy3.5-5.9.0
  pypy3.5-5.10.0-src
  pypy3.5-5.10.0
  pypy3.5-5.10.1-src
  pypy3.5-5.10.1
  pypy3.5-6.0.0-src
  pypy3.5-6.0.0
  pypy3.5-7.0.0-src
  pypy3.5-7.0.0
  pypy3.6-7.0.0-src
  pypy3.6-7.0.0
  pypy3.6-7.1.0-src
  pypy3.6-7.1.0
  pypy3.6-7.1.1-src
  pypy3.6-7.1.1
  pypy3.6-7.2.0-src
  pypy3.6-7.2.0
  pypy3.6-7.3.0-src
  pypy3.6-7.3.0
  pypy3.6-7.3.1-src
  pypy3.6-7.3.1
  pyston-0.5.1
  pyston-0.6.0
  pyston-0.6.1
  stackless-dev
  stackless-2.7-dev
  stackless-2.7.2
  stackless-2.7.3
  stackless-2.7.4
  stackless-2.7.5
  stackless-2.7.6
  stackless-2.7.7
  stackless-2.7.8
  stackless-2.7.9
  stackless-2.7.10
  stackless-2.7.11
  stackless-2.7.12
  stackless-2.7.14
  stackless-3.2.2
  stackless-3.2.5
  stackless-3.3.5
  stackless-3.3.7
  stackless-3.4-dev
  stackless-3.4.1
  stackless-3.4.2
  stackless-3.4.7
  stackless-3.5.4
  stackless-3.7.5
```

---
#Pyenv (new interpreter)

Install new Python interpreter at `$HOME/.pyenv/versions/X.Y.Z`
```bash
> pyenv install 3.6.5
```

Change Python interpreter globally
```bash
> pyenv global 3.6.5

```
Change Python interpreter locally
```bash
> pyenv local 3.6.5
```
This generates a text file with python interpreter information

```bash
> tree -al
.
└── .python-version
```

--
.green[**That is it!** The interpreter is changed if the script started <br> 
in the folder with the `.python-version` file.]

---
# Poetry (Project creation)

*Create new environment*
```bash
poetry new awesome-demo
```
--
*Project folder structure*
```bash
> tree awesome-demo 
awesome-demo
├── awesome_demo
│   └── __init__.py
├── pyproject.toml
├── README.rst
└── tests
    ├── __init__.py
    └── test_awesome_demo.py
```
---

# Poetry (Project creation)

Contents of `pyproject.toml`

```bash
> cat awesome-demo/pyproject.toml
[tool.poetry]
name = "awesome-demo"
version = "0.1.0"
description = ""
authors = ["ucyo <cayoglu@me.com>"]

[tool.poetry.dependencies]
python = "^3.6"

[tool.poetry.dev-dependencies]
pytest = "^5.2"

[build-system]
requires = ["poetry>=0.12"]
build-backend = "poetry.masonry.api"
```

`pytproject.toml` replaces all other setup files e.g.

.left-column[
- `setup.py` 
- `requirements.txt`
]
.right-column[
- `setup.cfg`
- `MANIFEST.in`
- `Pipfile`
]

---

# Poetry (Dependency management)

*Add dependency*
```bash
poetry add numpy pandas
```

*Add development dependency*
```bash
poetry add -D black
```

---

New `pyproject.toml` file
```bash
> cat pyproject.toml             
[tool.poetry]
name = "awesome-demo"
version = "0.1.0"
description = ""
authors = ["ucyo <cayoglu@me.com>"]

[tool.poetry.dependencies]
python = "^3.6"
*numpy = "^1.19.1"

[tool.poetry.dev-dependencies]
pytest = "^5.2"
*black = "^19.10b0"

[build-system]
requires = ["poetry>=0.12"]
build-backend = "poetry.masonry.api"
```
--
Additional file `poetry.lock` created
```bash
> tree awesome-demo
awesome-demo
├── awesome_demo
│   └── __init__.py
*├── poetry.lock
├── pyproject.toml
├── README.rst
└── tests
    ├── __init__.py
    └── test_awesome_demo.py
```

---

# Poetry (Dependency management)

*Add dependency*
```bash
poetry add numpy pandas
```

*Add development dependency*
```bash
poetry add -D black
```
--
*Remove dependency*
```bash
poetry remove numpy
```
--
*Update dependencies to latest version*
```bash
poetry update
```

*Start CLI with environment*
```bash
poetry shell
```

---
# Poetry (Environment creation and usage)

*Create environment*
```bash
poetry install
```

New folder structure
```bash
> tree awesome-demo -al -L 2 
awesome-demo
├── awesome_demo
│   └── __init__.py
├── poetry.lock
├── pyproject.toml
├── README.rst
├── tests
│   ├── __init__.py
│   └── test_awesome_demo.py
*└── .venv
    ├── bin
    ├── include
    ├── lib
    ├── lib64 -> lib  [recursive, not followed]
    ├── pip-selfcheck.json
    └── pyvenv.cfg
```

---
# Poetry (Sharing)

*Build single file sources and wheel*
```bash
> poetry build   
Building awesome-demo (0.1.0)
 - Building sdist
 - Built awesome-demo-0.1.0.tar.gz

 - Building wheel
 - Built awesome_demo-0.1.0-py3-none-any.whl
```

*Publish code on PyPI*
```bash
poetry publish
```
---

# There are other alternatives

- (Ana)conda <br> Environments incl. binaries
- venv
- virtualenv +virtualenvwrapper
- pipenv
---

class: center, middle
background-image: url(Thats_all_folks.svg)
background-size: cover


    </textarea>
    <script src="https://remarkjs.com/downloads/remark-latest.min.js">
    </script>
    <script>
      var slideshow = remark.create({
        ratio: '4:3',
        highlightStyle: 'dracula',
        highlightLines: true,
      });
    </script>
  </body>
</html>

